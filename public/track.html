<!doctype html>
<html>
<head><meta charset="utf-8"><title>Driver Tracker</title></head>
<body>
  <h2>Driver Tracker</h2>
  <label>Bus ID: <input id="busId" value="BUS_101" /></label>
  <button id="start">Start</button>
  <button id="stop">Stop</button>
  <div id="status">idle</div>

  <script type="module" src="./firebase.js"></script>
  <script>
    const { db, ref, set } = window.fb;
    let timer=null;

    document.getElementById('start').addEventListener('click', ()=>{
      const busId = document.getElementById('busId').value.trim();
      if(!busId) return alert('Enter bus id');

      if(!navigator.geolocation) return alert('Geolocation not supported');

      timer = setInterval(()=> {
        navigator.geolocation.getCurrentPosition(pos=>{
          const lat = pos.coords.latitude, lon = pos.coords.longitude;
          const speedKmh = pos.coords.speed !== null ? pos.coords.speed*3.6 : 0;
          set(ref(db,`buses/${busId}`), { id:busId, lat, lon, time: Date.now(), speed: Math.round(speedKmh) });
          document.getElementById('status').innerText = `Sent @ ${new Date().toLocaleTimeString()}`;
        }, err => {
          document.getElementById('status').innerText = 'GPS error ' + err.message;
        });
      }, 4000);
    });

    document.getElementById('stop').addEventListener('click', ()=> {
      clearInterval(timer);
      document.getElementById('status').innerText='stopped';
    });
  </script>
</body>
</html>
